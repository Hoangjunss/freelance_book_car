<app-notification></app-notification>
<div class="container mt-5 cart-container">
    <h2 class="mb-4 text-center">Giỏ hàng của bạn</h2>

    <!-- Product list -->
    <ul class="list-group mb-4" *ngIf="products.length > 0">
        <li *ngFor="let product of products" class="list-group-item d-flex flex-column flex-md-row align-items-start">
            <div class="d-flex align-items-center w-100">
                <img [src]="product.image" alt="{{ product.name }}" class="img-thumbnail mr-3" style="width: 100px;">
                <div class="product-info text-center text-md-left">
                    <h5>{{ product.name }}</h5>
                    <p class="price mb-0">Giá: {{ product.price | number }} đ</p>

                    <ng-container *ngIf="product.type === 'tour'">
                        <p><strong>Ngày bắt đầu:</strong> {{ product.schedule.timeStartTour | date:'dd/MM/yyyy HH:mm' }}
                        </p>
                        <p><strong>Điểm bắt đầu:</strong> {{ product.startLocation }}</p>
                        <p><strong>Điểm kết thúc:</strong> {{ product.endLocation }}</p>
                    </ng-container>

                    <ng-container *ngIf="product.type === 'hotel'">
                        <p><strong>Thời gian check-in:</strong> {{ product.startDate | date:'dd/MM/yyyy' }}</p>
                        <p><strong>Số ngày:</strong> {{ product.quantity }}</p>
                        <p><strong>Vị trí:</strong> {{ product.location }}</p>
                    </ng-container>

                    <ng-container *ngIf="product.type === 'ticket'">
                        <p><strong>Địa điểm:</strong> {{ product.venue }}</p>
                        <p><strong>Ngày diễn ra:</strong> {{ product.dateEvent | date:'dd/MM/yyyy' }}</p>
                    </ng-container>
                </div>
            </div>
            <div class="d-flex flex-column align-items-center quantity">
                <div class="quantity-controls d-flex justify-content-center align-items-center mt-2 mb-2 mb-md-0">
                    <button class="btn btn-sm btn-light" (click)="decreaseQuantity(product)">-</button>
                    <input type="text" [(ngModel)]="product.quantity" class="form-control text-center quantity-input" readonly>
                    <button class="btn btn-sm btn-light" (click)="increaseQuantity(product)">+</button>
                </div>
                <button class="btn btn-sm btn-danger mt-2" (click)="removeProduct(product)">Xóa</button>
            </div>
                      
        </li>
    </ul>

    <!-- Total Price and Checkout -->
    <div *ngIf="products.length > 0" class="d-flex justify-content-between align-items-center total-container">
        <h4 class="total-label">Tổng cộng:</h4>
        <h4 class="total-price">{{ total | number }} đ</h4>
    </div>

    <div *ngIf="products.length > 0" class="text-right mt-4">
        <button class="btn btn-success btn-checkout" (click)="updateBookingType()">Thanh toán</button>
    </div>

    <div *ngIf="!isLoggedIn" class="alert alert-warning text-center">
        Bạn cần <a routerLink="/login">đăng nhập</a> để xem giỏ hàng của bạn.
    </div>

    <!-- Empty cart message -->
    <div *ngIf="products.length === 0 && isLoggedIn" class="empty-cart-message text-center mt-4">
        <p>Giỏ hàng của bạn trống</p>
    </div>
</div>

<app-custom-modal [isVisible]="isModalVisible" title="Xác nhận thanh toán"
    message="Bạn có chắc chắn muốn thanh toán không?" (confirmed)="onConfirmed()" (closed)="onClosed()">
</app-custom-modal>
<app-custom-modal [isVisible]="isDeleteModalVisible" title="Xác nhận xóa"
    message="Bạn có chắc chắn muốn xóa sản phẩm này không?" (confirmed)="onDeleteConfirmed()" (closed)="onDeleteClosed()">
</app-custom-modal>
